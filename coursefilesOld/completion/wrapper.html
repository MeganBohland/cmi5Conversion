<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <title>Wrapper</title>
    <script src="../js/common.js" type="text/javascript"></script>
    <script src="js/progress.js" type="text/javascript"></script>
    <script language='javascript'>
        currentLsn = -1;
        currentTopic = -1;
        currentSubtopic = -1;
        caption = 0;
        finished = 0;
        var progress;
        var showResume;

        function gup(name) {
            name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
            var regexS = "[\\?&]" + name + "=([^&#]*)";
            var regex = new RegExp(regexS);
            var results = regex.exec(window.location.href);
            if (results == null) {
                return "";
            } else {
                return results[1];
            }
        }

        var branchContinuation = gup("branchContinuation");

        var expand; //this is the variable that tells us what topic to expand
        expand = 0;
        expandlsn = 0;
        checkLessonCompletionFlag = false;
        lessonCompleted = false;
        var itemHashtable = {}; //suspended data will be stored in a hash

        var checkLessonCompletion = function () {
            var pagesViewed = currentSubtopic - 1; //0;
            var length = progress[0][0].length;
            if (pagesViewed == length - 2 && lessonCompleted == false) {
                lessonCompleted = true;
                parent.setLessonStatus('complete');
                checkLessonCompletionFlag = true;
            }
        }

        var first = function () {
            var numTopics = progress[currentLsn].length;
            var numSubTopics = progress[currentLsn][currentTopic].length;

            if (currentSubtopic > 2) {
                currentSubtopic = 2;
                this.Content.location.href = progress[currentLsn][currentTopic][currentSubtopic][2];
            }
            return false;
        }

        var last = function () {
            var numTopics = progress[currentLsn].length;
            var numSubTopics = progress[currentLsn][currentTopic].length;

            if (currentSubtopic < numSubTopics - 1) {
                currentSubtopic = numSubTopics - 1;
                this.Content.location.href = progress[currentLsn][currentTopic][currentSubtopic][2];
            }
            return false;
        }

        var next = function () {
            var numTopics = progress[currentLsn].length;
            var numSubTopics = progress[currentLsn][currentTopic].length;

            if (currentSubtopic < numSubTopics - 1) {
                currentSubtopic++;
                this.Content.location.href = progress[currentLsn][currentTopic][currentSubtopic][2];
                parent.saveLessonProgress();
            } else {
                alert('Click the Next Lesson button');
            }

            return false;
        }

        var back = function () {
            /* Returns to the last subtopic of the previous topic */
            if (currentSubtopic > 2) {
                currentSubtopic--;
                this.Content.location = progress[currentLsn][currentTopic][currentSubtopic][2];
                parent.saveLessonProgress();
            }
        }

        var getProgress = function () {
            currentLsn = 0;
            currentTopic = 0;
            currentSubtopic = parent.getLastSubTopic();

            if (branchContinuation != '') {
                currentLsn = 0;
                currentTopic = 0;

                for (var i = 0; i < progress[currentLsn][currentTopic].length; i++) {
                    var pageUrl = this.Content.location.href = progress[currentLsn][currentTopic][i][2];
                    if (pageUrl == branchContinuation) {
                        currentSubtopic = i;
                        this.Content.location.href = branchContinuation;
                        return; //short circuit...
                    }
                }
            } else {

                var temppagelocation = remediationParam('remediationId'); //remedation call
                if (temppagelocation == '0') {
                    // Condition templastPage != 'true' is necesary to handle the previews.
                    templastPage = parent.getLastPage(); //doLMSGetValue("cmi.core.lesson_location");
                    if (templastPage != '' &&
                        templastPage != "blank.html" &&
                        templastPage != "null" &&
                        templastPage != progress[currentLsn][currentTopic][2][2] &&
                        templastPage != 'true'
                    ) {
                        if (confirm("Do you want to return to the last page you viewed?")) {

                            currentLsn = 0;
                            currentTopic = 0;
                            this.Content.location.href = templastPage;
                        } else {
                            currentLsn = 0;
                            currentTopic = 0;
                            currentSubtopic = 2;
                            this.Content.location.href = progress[currentLsn][currentTopic][currentSubtopic][2];
                        }
                    } else {
                        this.Content.location.href = progress[0][0][2][2];
                        currentLsn = 0;
                        currentTopic = 0;
                        currentSubtopic = 2;
                    }
                } else {
                    currentLsn = 0;
                    currentTopic = 0;
                    this.Content.location.href = progress[currentLsn][currentTopic][currentSubtopic][2];
                }
            }
        }

        function remediationParam(name) {
            name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
            var regexS = "[\\?&]" + name + "=([^&#]*)";
            var regex = new RegExp(regexS);
            var results = regex.exec(window.location.href);
            if (results == null) return "0";
            else return results[1];
        }

        var goto = function (url) {
            document.location.href = url + '?returnAddress=' + progress[currentLsn][currentTopic][currentSubtopic][2];
            return false;

        }

        function updateLocation(url) {}

        window.onload = getProgress;

    </script>
    <noscript>
        <p>#{messages['page.script.instruction']}</p>
    </noscript>
</head>
<frameset rows="0,*" border="0">
    <frame NORESIZE src="scorm.html" name="SCORM" scrolling="auto" title="SCORM Display Frame" />
    <frame NORESIZE src="blank.html" name="Content" scrolling="no" title="Content Display Frame" />
    <noframes>
        Your browser does not support frames. Frames are required to successfully execute this courseware.
    </noframes>
</frameset>

</html>