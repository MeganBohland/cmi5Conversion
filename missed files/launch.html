<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>CTIP-GA-US011: Combating Trafficking in Persons (CTIP)</title>
    <link rel="stylesheet" href="coursefiles/css/launch.css" />
    <link rel="stylesheet" href="coursefiles/css/debug.css" />
<!-- Core JS libraries -->
    <script src="coursefiles/js/json2.js"></script>
    <script src="coursefiles/js/jquery-1.11.1.min.js"></script>
    <script src="coursefiles/js/jquery-migrate-1.2.1.min.js"></script>
    <script src="coursefiles/js/debug-standalone.js"></script>
    <script src="coursefiles/js/launch.js"></script>
    <script src="coursefiles/js/bowser.js"></script>
    <script src="coursefiles/js/parseuri.js"></script>
    <script src="coursefiles/js/ADL_XAPIWrapper.min.js"></script>
    <script src="coursefiles/js/cmi5-hooks.js"></script>
  <!-- Course + CMI5 scripts -->
    <script src="js/course.js"></script>
    <script src="js/course_cmi5.js"></script>
    <script src="js/cmi5.min.js"></script>

    <style>
        #mainFrame {
            position: absolute;
            top: 61px;
            left: 275px;
        }
    </style>
</head>
<body onbeforeunload="saveModuleProgress();">

<div id="header">
    <div id="title">CTIP-GA-US011: Combating Trafficking in Persons (CTIP)</div>
    <div id="banner"></div>
</div>

<div id="shell">
    <div id="course_menu">
        <p><strong>Course Navigation</strong></p>
        <ul id="navmenuitems"></ul> <!-- dynamically filled -->
    </div>
<!-- Content iframe -->
    <div id="content">
        <iframe name="mainFrame" id="mainFrame" src="coursefiles/ContentPages/L01/L01_010.html" frameborder="0"></iframe>
    </div>
</div>

<div id="debug" class="layer" style="display:none">
    <iframe frameborder="0" scrolling="no"></iframe>
    <div id="debug_msg"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // Instantiate the Course with CMI5 tracking
    const course = new Course({
        completionBehavior: "quiz",
        enableBookmarking: true,
        navigateOnLaunch: true,
        navigationInjectIntoContent: false,
        trackingPlugin: new CourseCmi5Plugin()
    });

    // --- Dynamic navigation menu ---
    Course.prototype.getPageTitle = function(pageFileName) {
        let name = pageFileName.replace(".html", "").replace(/_/g, " ");
        return name.charAt(0).toUpperCase() + name.slice(1);
    };

    Course.prototype.renderNavTree = function() {
        let s = "";
        for (let i = 0; i < this.pageList.length; i++) {
            let title = this.getPageTitle(this.pageList[i]);
            s += `<li class="navmenuitem" data-pageidx="${i}">${title}</li>`;
        }
        const navEl = document.getElementById("navmenuitems");
        if (navEl) navEl.innerHTML = s;
    };

    course.renderNavTree();

    // --- Wire up navigation buttons if they exist ---
    const nextBtn = document.getElementById("next");
    if (nextBtn) nextBtn.addEventListener("click", () => course.nextPage());

    const prevBtn = document.getElementById("prev");
    if (prevBtn) prevBtn.addEventListener("click", () => course.previousPage());

    // --- Capture exit buttons and nav menu clicks ---
    document.addEventListener("click", e => {
        if (e.target && e.target.matches(".exit-button")) course.exit();
        if (e.target && e.target.matches(".navmenuitem")) {
            course.gotoPage(Number(e.target.dataset.pageidx));
        }
    });

    // --- Start CMI5 session ---
    if (typeof course.trackingPlugin?.initialize === "function") {
        course.trackingPlugin.initialize(() => {
            console.log("CMI5 session initialized");
        }, (stmt) => {
            console.log("Statement sent:", stmt);
        });
    }
});
</script>

</body>
</html>
